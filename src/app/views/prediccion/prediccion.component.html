<div class="contenedor">
  <h2>Análisis de Radiografías para Tuberculosis</h2>
  
  <div class="backend-status" [class.connected]="isBackendConnected">
    <i class="status-icon" [class.connected]="isBackendConnected"></i>
    {{ backendStatus }}
  </div>

  <div *ngIf="!isBackendConnected" class="alert warning">
    No se puede conectar con el servidor de análisis. Por favor, verifica que el backend esté en ejecución.
  </div>

  <div *ngIf="isBackendConnected">
    <p>Para realizar el análisis, sube una imagen clara de una radiografía de tórax (JPEG, PNG).</p>

    <div class="alert error" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <div class="preview-box" *ngIf="imagePreviewUrl">
      <p class="titulo-previa">Vista Previa</p>
      <img [src]="imagePreviewUrl" alt="Vista previa de la imagen" />
      <p class="file-name">{{ selectedFile?.name }}</p>
    </div>

    <div class="file-upload">
      <input type="file" id="fileInput" (change)="onFileSelected($event)" 
             accept="image/jpeg, image/png" [disabled]="!isBackendConnected" />
      <label for="fileInput" class="upload-btn">
        <i class="fa fa-cloud-upload"></i>
      </label>
    </div>

    <button class="btn-analizar" 
            [disabled]="!selectedFile || isLoading || !isBackendConnected" 
            (click)="analizar()">
      <span *ngIf="!isLoading">Analizar imagen</span>
      <span *ngIf="isLoading">
        <i class="fa fa-spinner fa-spin"></i> Procesando...
      </span>
    </button>

    <div *ngIf="result" class="result-container">
      <h3>Resultados del Análisis</h3>
      
      <div class="diagnosis" [class]="getDiagnosisClass(result.diagnostico)">
        <h4>Diagnóstico:</h4>
        <p>{{ getDiagnosisText(result.diagnostico) }}</p>
        <p *ngIf="result.confianza" class="confidence">
          Confianza: {{ result.confianza | number:'1.1-1' }}%
        </p>
      </div>
      
      <div *ngIf="result.es_radiografia" class="quality-report">
        <h4>Calidad Técnica:</h4>
        <p><strong>Penetración:</strong> {{ result.hallazgos_tecnicos.diagnostico_tecnico }}</p>
        <p><strong>Contraste:</strong> {{ result.hallazgos_tecnicos.contraste | number:'1.1-1' }}</p>
        <p><strong>Posible causa:</strong> {{ result.hallazgos_tecnicos.posible_causa }}</p>
        <p><strong>Recomendación:</strong> {{ result.recomendacion_clinica }}</p>
      </div>
    </div>
  </div>
</div>